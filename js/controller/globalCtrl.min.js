function addDynamicTappedClass(domClass){$('.'+domClass+' a').on('touchstart',function(e){$(this).addClass('tapped')});$('.'+domClass+' a').on('touchend',function(e){$(this).removeClass('tapped')});$('.'+domClass+' a').on('tap',function(e){e.preventDefault();return false})}function modalCtrl($scope,$modalInstance,users){$scope.users=users;$scope.deleteInit=function(){addDynamicTappedClass("user-delete")};$scope.cancelInit=function(){addDynamicTappedClass("user-cancel")};$scope.editInit=function(){addDynamicTappedClass("user-edit")};$scope.editUser=function(){var lastnameUser=$('.lastname-user-edit').val();var firstnameUser=$('.firstname-user-edit').val();editUserData(users,$modalInstance,lastnameUser,firstnameUser)};$scope.cancelEdit=function(){$modalInstance.dismiss('cancel')};$scope.deleteUser=function(){};$scope.cancelDelete=function(){$modalInstance.dismiss('cancel')}}function addCtrl($scope){$scope.menu='home'}function configCtrl($scope,GetAppService,$timeout,$modal,$log){$scope.panel=0;$(".rt-parameters").fadeIn(500);$('a').on('touchstart',function(e){$(this).addClass('tapped')});$('a').on('touchend',function(e){$(this).removeClass('tapped')});$('a').on('tap',function(e){e.preventDefault();return false});$scope.backConfig=function(panel){if(panel==2){$scope.panel=1}else if(panel==1){$(".view").css("overflow-x","hidden");$scope.panel=0;$(".rt-general").hide();$(".rt-parameters").fadeIn(500)}};$scope.test=function(){$scope.panel=2};$scope.importData=function(){$(".view").css("overflow-x","initial");$scope.panel=1;$(".rt-general").hide();$(".rt-import-data").fadeIn(500);$scope.config_action=0;browseStatus()};$scope.dataInitialize=function(){if(!$('.btn-data-import').hasClass('btn-data-import-disabled')){$(".loader").show();importDataBase()}};$scope.dataDelete=function(){if(!$('.btn-data-delete').hasClass('btn-data-delete-disabled')){$(".loader").show();deleteDataBase()}};$scope.dataLogs=function(){logs='';db=window.openDatabase("Videotheque_v1","1.0","Videotheque database",200000);db.transaction(dataLogsAction,function(){alert('error dataLogs')},function(){alert(logs)})};function dataLogsAction(tx){tx.executeSql("SELECT COUNT(*) AS result FROM movie_typeavis",[],function(tx,response){logs+="movie_typeavis : "+response.rows.item(0).result},function(tx,error){});tx.executeSql("SELECT COUNT(*) AS result FROM movie",[],function(tx,response){logs+=" -> movie : "+response.rows.item(0).result},function(tx,error){});tx.executeSql("SELECT COUNT(*) AS result FROM movie_typemovies",[],function(tx,response){logs+=" -> movie_typemovies : "+response.rows.item(0).result},function(tx,error){})};$scope.configUsers=function(){$(".view").css("overflow-x","initial");$scope.panel=1;$(".rt-general").hide();$(".rt-config-user").fadeIn(500);$scope.config_action=1;$scope.userList="";$scope.initConfigUser()};$scope.initConfigUser=function(){var tempList=GetAppService.getUsers($scope);$timeout(function(){$scope.$apply(function(){})},50)};$scope.expand=function(e){$elem=$(e.currentTarget);$(".config-user-name-left").hide();$(".config-user-name-right").hide();$("#"+e.currentTarget.id+" div.config-user-name-left").show();$("#"+e.currentTarget.id+" div.config-user-name-right").show();addDynamicTappedClass("config-user-name-left");addDynamicTappedClass("config-user-name-right");$elem.addClass('ra_config_user').siblings().removeClass('ra_config_user')};$scope.users='';$scope.open=function(size,template,user,e){switch(template){case"mdEditUser.html":$scope.users=user;var modalInstance=$modal.open({templateUrl:template,controller:'modalCtrl',size:size,resolve:{users:function(){return $scope.users}}});modalInstance.result.then(function(){$scope.initConfigUser()},function(){$log.info('Modal dismissed at: '+new Date())});break;case"mdDeleteUser.html":if(!user.is_pret){$scope.users=user;var modalInstance=$modal.open({templateUrl:template,controller:'modalCtrl',size:size,resolve:{users:function(){return $scope.users}}});modalInstance.result.then(function(selectedItem){$scope.initConfigUser()},function(){$log.info('Modal dismissed at: '+new Date())})}break}};$scope.userPretInfo=function(){alert('info utilisateur')};$scope.addUser=function(){$(".view").css("overflow-x","initial");$scope.panel=1;$(".rt-general").hide();$(".rt-add-user").fadeIn(500);$scope.config_action=2;lastUserAdd()};$(".lastname-user").bind("change paste keyup",function(){btnSaveUserStatus()});$(".firstname-user").bind("change paste keyup",function(){btnSaveUserStatus()});function btnSaveUserStatus(){var firstname=$(".firstname-user").val();var lastname=$(".lastname-user").val();if(firstname!=""&&lastname!=""){if($('.btn-save-new-user').hasClass('btn-save-new-user-disabled')){$('.btn-save-new-user').removeClass('btn-save-new-user-disabled')}}else{if(!$('.btn-save-new-user').hasClass('btn-save-new-user-disabled')){$('.btn-save-new-user').addClass('btn-save-new-user-disabled')}}};$scope.saveNewUser=function(){var firstname=$(".firstname-user").val();var lastname=$(".lastname-user").val();if(!$('.btn-save-new-user').hasClass('btn-save-new-user-disabled')){if(firstname!=""&&lastname!=""){saveUser(firstname,lastname)}}};$scope.saveData=function(){$scope.panel=1;$(".rt-general").hide();$(".rt-save-data").fadeIn(500);$scope.config_action=3}}function exchangeCtrl($scope){$scope.menu='home'}function homeCtrl($scope){}function listCtrl($scope,GetAppService,$timeout){$scope.panel=0;$scope.itemsPerPage=25;$scope.loader=false;$(".rt-filter-list").fadeIn(500);$('a').on('touchstart',function(e){$(this).addClass('tapped')});$('a').on('touchend',function(e){$(this).removeClass('tapped')});$('a').on('tap',function(e){e.preventDefault();return false});$scope.backConfig=function(panel){if(panel==2){$scope.panel=1}else if(panel==1){$(".view").css("overflow-x","hidden");if(!$('.pagination-content').hasClass('hide')){$('.pagination-content').addClass('hide')}$scope.panel=0;$(".rt-general").hide();$(".rt-filter-list").fadeIn(500)}};function addDynamicTappedClass(domClass){$('.'+domClass+' a').on('touchstart',function(e){$(this).addClass('tapped')});$('.'+domClass+' a').on('touchend',function(e){$(this).removeClass('tapped')});$('.'+domClass+' a').on('tap',function(e){e.preventDefault();return false})};$scope.populateTypeMovie=function(){$scope.listFilter="";var tempList=GetAppService.getFilters($scope)};$scope.selectFilter=function(filterId,filterType){var htmlFilter=filterType+'&nbsp;<span class="caret"></span>';$(".hf-filter-type-id").val(filterId);$(".filter-type").html(htmlFilter)};$(".filter-title").bind("change paste keyup",function(){btnFilterStatus()});function btnFilterStatus(){var title=$(".filter-title").val();var idType=$(".hf-filter-type-id").val();if(title!=""&&idType!=null&&idType!=undefined){if($('.btn-filter-filter').hasClass('btn-filter-disabled')){$('.btn-filter-filter').removeClass('btn-filter-disabled')}}else{if(!$('.btn-filter-filter').hasClass('btn-filter-disabled')){$('.btn-filter-filter').addClass('btn-filter-disabled')}}};$scope.filterMovie=function(){var title=$(".filter-title").val();var idType=$(".hf-filter-type-id").val();if(title!=""&&idType!=null&&idType!=undefined){alert('filtre')}};$scope.searchMovie=function(firstLoad){$scope.loader=true;$scope.panel=1;if(firstLoad){$scope.currentPage=1;$scope.beginItems=0}$(".rt-general").hide();$(".rt-result-list").fadeIn(500);$scope.listMovies="";var tempList=GetAppService.getAllList($scope);$timeout(function(){$scope.$apply(function(){$scope.loader=false})},100)};$scope.expand=function(e){$elem=$(e.currentTarget);$colorMovie=$(".color_movies_pret");$colorMovieTarget=$("#"+e.currentTarget.id+" div.color_movies_pret");$btnEditMovie=$(".btn_edit_movie");$btnEditMovieTarget=$("#"+e.currentTarget.id+" span.btn_edit_movie");$titleMovie=$(".movie_title");$titleMovieTarget=$("#"+e.currentTarget.id+" div.movie_title");$nbMovieMovie=$(".movie_nbMovie");$nbMovieMovieTarget=$("#"+e.currentTarget.id+" div.movie_nbMovie");$nbDiscMovie=$(".movie_nbDisc");$nbDiscMovieTarget=$("#"+e.currentTarget.id+" div.movie_nbDisc");$typeMovie=$(".movie_type");$typeMovieTarget=$("#"+e.currentTarget.id+" div.movie_type");$avisMovie=$(".movie_avis");$avisMovieTarget=$("#"+e.currentTarget.id+" div.movie_avis");$elem.addClass('ra_list_movies').siblings().removeClass('ra_list_movies');$colorMovie.removeClass('color_movie_pret_xs').addClass('color_movie_pret_sm');$colorMovieTarget.removeClass('color_movie_pret_sm').addClass('color_movie_pret_xs');$btnEditMovie.removeClass('btn_edit_movie_xs').addClass('btn_edit_movie_sm');$btnEditMovieTarget.removeClass('btn_edit_movie_sm').addClass('btn_edit_movie_xs');$titleMovie.removeClass('movie_title_xs').addClass('movie_title_sm');$titleMovieTarget.removeClass('movie_title_sm').addClass('movie_title_xs');$nbMovieMovie.removeClass('movie_nbMovie_xs').addClass('movie_nbMovie_sm');$nbMovieMovieTarget.removeClass('movie_nbMovie_sm').addClass('movie_nbMovie_xs');$nbDiscMovie.removeClass('movie_nbDisc_xs').addClass('movie_nbDisc_sm');$nbDiscMovieTarget.removeClass('movie_nbDisc_sm').addClass('movie_nbDisc_xs');$typeMovie.removeClass('movie_type_xs').addClass('movie_type_sm');$typeMovieTarget.removeClass('movie_type_sm').addClass('movie_type_xs');$avisMovie.removeClass('movie_avis_xs').addClass('movie_avis_sm');$avisMovieTarget.removeClass('movie_avis_sm').addClass('movie_avis_xs');addDynamicTappedClass("btn_edit_movie")};$scope.editMovie=function(idMovie){alert(idMovie)};$scope.getPage=function(){$scope.beginItems=(($scope.currentPage-1)*$scope.itemsPerPage)};$scope.pageChanged=function(){$scope.getPage();$scope.searchMovie(false)}}function navCtrl($scope){$scope.menu='home';$scope.nav=function(page,cssClass){$("#icon-header").removeClass().addClass(cssClass);$scope.menu=page;$(".rt-import-data").hide();$(".rt-config-user").hide();$(".rt-add-user").hide();$(".rt-save-data").hide()}}